<!DOCTYPE html>
<html>
<head>
  <title>운동 기록 페이지</title>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css?family=Questrial&display=swap');

    body {
      background-color: white;
    }

    div {
      background-color: white;
      height: auto;
      width: 400px;
      margin: 0px;
      padding: 20px;
      float: left;
    }

    td {
      width: 50px;
      height: 50px;
    }

    .Calendar {
      text-align: center;
    }

    .Calendar>thead>tr:first-child>td {
      font-family: 'Questrial', sans-serif;
      font-size: 1.1em;
      font-weight: bold;
    }

    .Calendar>thead>tr:last-child>td {
      font-family: 'Questrial', sans-serif;
      font-weight: 600;
    }

    .Calendar>tbody>tr>td>p {
      font-family: 'Montserrat', sans-serif;
      height: 45px;
      width: 45px;
      border-radius: 45px;
      transition-duration: .2s;
      line-height: 45px;
      margin: 2.5px;
      display: block;
      text-align: center;
    }

    .pastDay {
      color: lightgray;
    }

    .today {
      background-color: #F5D042;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    .futureDay {
      background-color: #FFFFFF;
      cursor: pointer;
    }

    .futureDay:hover {
      background: #eee;
    }

    .futureDay.choiceDay,
    .today.choiceDay {
      background: #0A174E;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    .Calendar>tbody>tr>td:nth-child(7) {
      color: blue;
      font-weight: 600;
      cursor: pointer;
    }

    .Calendar>tbody>tr>td:nth-child(1) {
      color: red;
      font-weight: 600;
      cursor: pointer;
    }

    .recordForm {
      margin-top: 20px;
    }

    .recordForm input,
    .recordForm select {
      margin-bottom: 10px;
    }

    .recordList {
      margin-top: 20px;
    }


    /*운동정보 출력할 게시판*/ 
    .rounded-box {
      position: relative;
      width: 300px;
      height: 300px;
      background-color: #f0f0f0;
      color: black;
      border-radius: 15px;
      padding: 20px;
      margin-top: 50px;
    }

    .title-area {
      position: absolute;
      top: 0px; /* 위쪽 여백을 더 크게 조절 */
      left: 0;
      width: 94%;
      height: 50px;
      background-color: #3498db;
      padding: 10px;
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      color: #0a0a0a;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div>
    <table class="Calendar">
      <thead>
        <tr>
          <td onClick="prevCalendar();" style="cursor:pointer;">&#60;</td>
          <td colspan="5">
            <span id="calYear"></span>년
            <span id="calMonth"></span>월
          </td>
          <td onClick="nextCalendar();" style="cursor:pointer;">&#62;</td>
        </tr>
        <tr>
          <td>일</td>
          <td>월</td>
          <td>화</td>
          <td>수</td>
          <td>목</td>
          <td>금</td>
          <td>토</td>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div class="rounded-box">
    <div class="title-area">
      <!-- 운동 정보 저장 --><br><br><br>
      <label for="exerciseType">운동종류:</label>
      <select name="exercise" class="exerciseDate">
        <option value="exercise1" selected>exercise1</option>
        <option value="exercise2">exercise2</option>
        <option value="exercise3">exercise3</option>
        <option value="exercise4">exercise4</option>
      <select><br>

        <label for="exerciseCount">운동 개수:</label>
        <input type="text" class="exerciseCount"><br>

        <label for="exercisOther">다른 옵션:</label>
        <input type="number" class="exerciseOther"><br>  

        <button onclick="saveExercise()">운동 기록 저장</button>
        <!-- 운동정보 출력 -->
        <h3>저장된 운동 기록</h3>
        <ul id="exerciseList"></ul>
        <h5 id="userStatus"></h5>
    </div>
  </div>
  <script src="getinfo.js"></script>
  <script>
    window.onload = function () {buildCalendar();}
  
    let nowMonth = new Date();
    let today = new Date();
    today.setHours(0, 0, 0, 0);
  
    function buildCalendar() {
  
      let firstDate = new Date(nowMonth.getFullYear(), nowMonth.getMonth(), 1);
      let lastDate = new Date(nowMonth.getFullYear(), nowMonth.getMonth() + 1, 0);
  
      let tbody_Calendar = document.querySelector(".Calendar > tbody");
      document.getElementById("calYear").innerText = nowMonth.getFullYear();
      document.getElementById("calMonth").innerText = leftPad(nowMonth.getMonth() + 1);
  
      while (tbody_Calendar.rows.length > 0) {
        tbody_Calendar.deleteRow(tbody_Calendar.rows.length - 1);
      }
  
      let nowRow = tbody_Calendar.insertRow();
  
      for (let j = 0; j < firstDate.getDay(); j++) {
        let nowColumn = nowRow.insertCell();
      }
  
      for (let nowDay = firstDate; nowDay <= lastDate; nowDay.setDate(nowDay.getDate() + 1)) {
  
        let nowColumn = nowRow.insertCell();
  
        let newDIV = document.createElement("p");
        newDIV.innerHTML = leftPad(nowDay.getDate());
        nowColumn.appendChild(newDIV);
  
        if (nowDay.getDay() == 6) {
          nowRow = tbody_Calendar.insertRow();
        }
  
        if (nowDay < today) {
          newDIV.className = "pastDay";
        }
        else if (nowDay.getFullYear() == today.getFullYear() && nowDay.getMonth() == today.getMonth() && nowDay.getDate() == today.getDate()) { // 오늘인 경우           
          newDIV.className = "today";
          newDIV.onclick = function () {choiceDate(this);}
        }
        else {
          newDIV.className = "futureDay";
          newDIV.onclick = function () {choiceDate(this);}
        }
      }
    }
  
    function choiceDate(newDIV) {
      if (document.getElementsByClassName("choiceDay")[0]) {
        document.getElementsByClassName("choiceDay")[0].classList.remove("choiceDay");
      }
      newDIV.classList.add("choiceDay");
  
      // Load exercise records for the selected date
      var selectedDate = newDIV.firstChild.innerHTML;
      loadExerciseRecords(formatDate(selectedDate));
    }
  
    function prevCalendar() {
      nowMonth = new Date(nowMonth.getFullYear(), nowMonth.getMonth() - 1, nowMonth.getDate());
      buildCalendar();
    }
  
    function nextCalendar() {
      nowMonth = new Date(nowMonth.getFullYear(), nowMonth.getMonth() + 1, nowMonth.getDate());
      buildCalendar();
    }
  
    function leftPad(value) {
      if (value < 10) {
        value = "0" + value;
        return value;
      }
      return value;
    }
  
    function sendSelectedDate(date) {
      window.parent.postMessage({date: date}, '*');
    }
  
    function onDateClick(date) {
      sendSelectedDate(date);
    }
  
    function saveExerciseRecord() {
      var selectedDate = document.querySelector('.choiceDay p').innerHTML;
      var exerciseType = document.getElementById('exerciseType').value;
      var exerciseCount = document.getElementById('exerciseCount').value;
      var setCount = document.getElementById('setCount').value;
  
      addExerciseRecord(selectedDate, exerciseType, exerciseCount, setCount);
    }
  
  </script>
</body>
</html>